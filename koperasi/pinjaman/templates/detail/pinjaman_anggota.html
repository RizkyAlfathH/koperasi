{% extends "base.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/pages/pinjaman/detail/pinjaman_anggota.css' %}">
{% endblock %}

{% block title %}Pinjaman {{ anggota.nama }}{% endblock %}

{% block content %}

<div class="content-card">

    <h2>Pinjaman {{ anggota.nama }} ({{ anggota.nomor_anggota }})</h2>

    <!-- ===== TOMBOL BAYAR ===== -->
    <button class="btn-simpan" onclick="openBayarModal()">
        Bayar
    </button>

    <!-- ===== MODAL BAYAR ===== -->
    <div id="bayarModal" class="bayar-modal">
        <div class="bayar-card">
            <h3>Pilih Pinjaman Untuk Dibayar</h3>

            <ul class="list-pinjaman">
                {% for p in pinjaman_aktif %}
                    <li>
                        <a href="{% url 'pinjaman:bayar_pinjaman' p.id_pinjaman %}">
                            Pinjaman {{ p.id_jenis_pinjaman.nama_jenis }}
                        </a>
                    </li>
                {% empty %}
                    <li class="empty">Tidak ada pinjaman aktif</li>
                {% endfor %}
            </ul>

            <button class="btn-tutup" onclick="closeBayarModal()">Tutup</button>
        </div>
    </div>

    <!-- ===== TABEL PINJAMAN AKTIF ===== -->
    <table class="data-table" style="margin-top:20px;">
        <thead>
            <tr>
                <th>Tanggal</th>
                <th>Jenis</th>
                <th>Jumlah</th>
                <th>Angsuran</th>
                <th>Jasa (%)</th>
                <th>Jasa (Rp)</th>
                <th>Sisa</th>
                <th>Status</th>
                <th>Aksi</th>
            </tr>
        </thead>
        <tbody>
        {% for p in pinjaman_aktif %}
            <tr>
                <td>{{ p.tanggal_meminjam|date:"d F Y" }}</td>
                <td>{{ p.id_jenis_pinjaman.nama_jenis }}</td>
                <td>{{ p.jumlah_pinjaman|floatformat:0 }}</td>
                <td>{{ p.angsuran_per_bulan|floatformat:0 }}</td>
                <td>{{ p.jasa_persen }}%</td>
                <td>{{ p.jasa_rupiah|floatformat:0 }}</td>
                <td>{{ p.sisa_pinjaman|floatformat:0 }}</td>
                <td>
                    <span class="badge-status badge-belum">
                        Belum Lunas
                    </span>
                </td>
                <td class="action-group">
                    <a href="{% url 'pinjaman:detail_pinjaman' p.id_pinjaman %}" class="action-view">
                        <i class="ph-bold ph-eye"></i>
                    </a>
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="8" class="empty-state">
                    Tidak ada pinjaman aktif
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<!-- ===== RIWAYAT PINJAMAN ===== -->
<div class="content-card" style="margin-top:25px;">
    <h3>Riwayat Pinjaman</h3>

    <table class="data-table">
        <thead>
            <tr>
                <th>Tanggal</th>
                <th>Jenis</th>
                <th>Jumlah</th>
                <th>Jasa</th>
                <th>Total</th>
                <th>Status</th>
                <th>Aksi</th>
            </tr>
        </thead>
        <tbody>
        {% for p in riwayat_pinjaman %}
            <tr>
                <td>{{ p.tanggal_meminjam|date:"d F Y" }}</td>
                <td>{{ p.id_jenis_pinjaman.nama_jenis }}</td>
                <td>{{ p.jumlah_pinjaman|floatformat:0 }}</td>
                <td>{{ p.jasa_rupiah|floatformat:0 }}</td>
                <td>{{ p.jumlah_pinjaman|add:p.jasa_rupiah|floatformat:0 }}</td>
                <td>
                    <span class="badge-status badge-lunas">
                        Lunas
                    </span>
                </td>
                <td class="action-group">
                    <a href="{% url 'pinjaman:detail_pinjaman' p.id_pinjaman %}" class="action-view">
                        <i class="ph-bold ph-eye"></i>
                    </a>
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="6" class="empty-state">
                    Belum ada riwayat pinjaman
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<!-- ===== JS ===== -->
<script>
function openBayarModal(){
    document.getElementById('bayarModal').classList.add('active');
}
function closeBayarModal(){
    document.getElementById('bayarModal').classList.remove('active');
}
</script>

{% endblock %}
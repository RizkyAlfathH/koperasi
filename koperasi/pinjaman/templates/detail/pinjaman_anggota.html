{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}
{% block title %}Pinjaman {{ anggota.nama }}{% endblock %}

{% block content %}

<div class="content-card">

    <!-- ================= JUDUL ================= -->
    <h2>
        Pinjaman {{ anggota.nama }} ({{ anggota.nomor_anggota }})
    </h2>

    <!-- ================= TOMBOL BAYAR ================= -->
    <div style="margin: 15px 0;">
        <a href="#" class="btn-simpan"> Bayar
        </a>
    </div>

    <table class="data-table">
        <thead>
            <tr>
                <th>Tanggal Pinjam</th>
                <th>Jenis</th>
                <th>Jumlah Pinjaman</th>
                <th>Angsuran / Bulan</th>
                <th>Persentase Jasa</th>
                <th>Jumlah Jasa</th>
                <th>Total Bayar</th>
                <th>Sisa Pinjaman</th>
                <th>Status</th>
                <th style="text-align:center;">Aksi</th>
            </tr>
        </thead>
        <tbody>

        {% for p in pinjaman_aktif %}
            <tr>
                <!-- TANGGAL FORMAT INDONESIA -->
                <td>{{ p.tanggal_meminjam|date:"d F Y" }}</td>

                <td>{{ p.id_jenis_pinjaman.nama_jenis }}</td>

                <td class="rupiah-text">
                    {{ p.jumlah_pinjaman|floatformat:0 }}
                </td>

                <td class="rupiah-text">
                    {{ p.angsuran_per_bulan|floatformat:0 }}
                </td>

                <td>{{ p.jasa_persen }}%</td>

                <td class="rupiah-text">
                    {{ p.jasa_rupiah|floatformat:0 }}
                </td>

                <td class="rupiah-text">
                    {{ p.jumlah_pinjaman|add:p.jasa_rupiah|floatformat:0 }}
                </td>

                <td class="rupiah-text">
                    {{ p.sisa_pinjaman|floatformat:0 }}
                </td>

                <!-- STATUS -->
                <td>
                    {% if p.status == 'Lunas' %}
                        <span class="badge-status badge-lunas">Lunas</span>
                    {% else %}
                        <span class="badge-status badge-belum">Belum Lunas</span>
                    {% endif %}
                </td>

                <!-- AKSI -->
                <td class="action-group">
                    <a href="{% url 'pinjaman:detail_pinjaman' p.id_pinjaman %}" class="action-view">
                        <i class="ph-bold ph-eye"></i>
                    </a>
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="10" class="empty-state">
                    Belum ada pinjaman aktif
                </td>
            </tr>
        {% endfor %}

        </tbody>
    </table>
</div>

<!-- ================= RIWAYAT PINJAMAN ================= -->
<div class="content-card" style="margin-top:30px;">

    <h2>Riwayat Pinjaman</h2>

    <table class="data-table">
        <thead>
            <tr>
                <th>Tanggal Pinjam</th>
                <th>Jenis</th>
                <th>Jumlah Pinjaman</th>
                <th>Angsuran / Bulan</th>
                <th>Persentase Jasa</th>
                <th>Status</th>
                <th style="text-align:center;">Aksi</th>
            </tr>
        </thead>
        <tbody>

        {% for p in riwayat_pinjaman %}
            <tr>
                <td>{{ p.tanggal_meminjam|date:"d F Y" }}</td>

                <td>{{ p.id_jenis_pinjaman.nama_jenis }}</td>

                <td class="rupiah-text">
                    {{ p.jumlah_pinjaman|floatformat:0 }}
                </td>

                <td class="rupiah-text">
                    {{ p.angsuran_per_bulan|floatformat:0 }}
                </td>

                <td>{{ p.jasa_persen }}%</td>

                <td>
                    <span class="badge badge-secondary">
                        {{ p.status }}
                    </span>
                </td>

                <td class="action-group">
                    <a href="{% url 'pinjaman:detail_pinjaman' p.id_pinjaman %}" class="action-view">
                        <i class="ph-bold ph-eye"></i>
                    </a>
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="7" class="empty-state">
                    Belum ada riwayat pinjaman
                </td>
            </tr>
        {% endfor %}

        </tbody>
    </table>
</div>

<!-- ================= TOMBOL KEMBALI ================= -->
<div style="margin-top:20px; text-align:right;">
    <a href="{% url 'pinjaman:pinjaman_list' %}" class="btn-kembali">
        Kembali
    </a>
</div>

{% endblock %}